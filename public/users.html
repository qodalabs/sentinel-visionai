<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Management - Weapon Detection</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: #111; color: #fff; margin:0; padding:50px 20px; text-align:center; }
h1 { font-size:36px; margin-bottom:20px; color:#0f0; text-shadow:0 0 10px #0f0,0 0 20px #0f0,0 0 30px #0f0; }
table { width:90%; max-width:900px; margin:auto; border-collapse:collapse; background:#222; border-radius:10px; overflow:hidden; box-shadow:0 0 20px rgba(0,255,0,0.3); }
th, td { padding:12px 15px; text-align:left; border:1px solid #444; }
th { background:#333; font-weight:600; }
tr:nth-child(even){ background:#1a1a1a; }
tr:hover { background:#0f0a0f; }
.btn { padding:6px 12px; border:none; border-radius:5px; cursor:pointer; font-weight:500; transition:0.3s ease; font-family: 'Poppins', sans-serif; }
.delete-btn { background:#f00; color:#fff; }
.delete-btn:hover { background:#c00; box-shadow:0 0 10px rgba(255,0,0,0.5); }
</style>
</head>
<body>

<h1>User Management</h1>

<div id="userList">Loading...</div>

<script>
const token = localStorage.getItem('token');
if(!token){ 
  alert("Login required"); 
  window.location.href='login.html'; 
}

async function loadUsers(){
  try{
    const res = await fetch('/api/admin-users', { headers:{'Authorization':'Bearer '+token}});
    if(!res.ok) throw new Error('Fetch failed');
    const users = await res.json();
    const container = document.getElementById('userList');

    if(!users.length){ container.innerHTML='<p>No users found</p>'; return; }

    let html = `<table><tr><th>Username</th><th>Role</th><th>Actions</th></tr>`;
    users.forEach(user=>{
      html += `<tr>
        <td>${user.username}</td>
        <td>${user.role}</td>
        <td><button class="btn delete-btn" data-id="${user.id}">Delete</button></td>
      </tr>`;
    });
    html += `</table>`;
    container.innerHTML = html;

    // Attach delete event listeners
    document.querySelectorAll('.delete-btn').forEach(btn=>{
      btn.addEventListener('click', async e=>{
        const id = e.target.dataset.id;
        if(!confirm('Are you sure you want to delete this user?')) return;
        try{
          const res = await fetch('/api/users/'+id, { method:'DELETE', headers:{'Authorization':'Bearer '+token}});
          const data = await res.json();
          if(data.success) loadUsers();
          else alert(data.message || 'Error deleting user');
        } catch(err){
          console.error(err);
          alert('Error deleting user');
        }
      });
    });

  } catch(err){
    console.error(err);
    document.getElementById('userList').textContent='Error loading users';
  }
}

window.onload = loadUsers;
</script>

</body>
</html>
